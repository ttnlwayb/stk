<%@ page language="java" contentType="text/html; charset=BIG5"
    pageEncoding="BIG5"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="BIG5">
<title>KDJ Chart</title>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<style>
</style>
</head>
<body bgcolor="#DDDDDD">
<div id='mainDiv' style='width:80%'></div>
<div id='tmpDiv' style='display: none'>
	<label id='lab'><label>
	<canvas id="chart"></canvas>
</div>
<script>
var rgbs = [
	'rgb(0, 255, 0)',
	'rgb(0, 0, 255)',
	'rgb(255, 0, 0)',
	'rgb(255, 255, 0)',
	'rgb(255, 0, 255)',
	'rgb(0, 255, 255)',
	'rgb(255, 255, 255)'
];
var results = ${result};
var fakeresult = [
		{'t': '2023/4/17 09:00', 'n': '49'},
		{'t': '2023/4/17 09:00', 'n': '47'},
		{'t': '2023/4/17 09:01', 'n': '47'},
		{'t': '2023/4/17 09:01', 'n': '48'},
		{'t': '2023/4/17 09:02', 'n': '47'},
		{'t': '2023/4/17 09:02', 'n': '48'},
		{'t': '2023/4/17 09:03', 'n': '46'},
		{'t': '2023/4/17 09:03', 'n': '46'},
		{'t': '2023/4/17 09:04', 'n': '45'},
		{'t': '2023/4/17 09:04', 'n': '46'},
		{'t': '2023/4/17 09:05', 'n': '47'},
		{'t': '2023/4/17 09:05', 'n': '36'},
		{'t': '2023/4/17 09:06', 'n': '41'},
		{'t': '2023/4/17 09:06', 'n': '30'},
		{'t': '2023/4/17 09:07', 'n': '24'},
		{'t': '2023/4/17 09:07', 'n': '26'},
		{'t': '2023/4/17 09:08', 'n': '28'},
		{'t': '2023/4/17 09:08', 'n': '29'},
		{'t': '2023/4/17 09:09', 'n': '30'},
		{'t': '2023/4/17 09:09', 'n': '29'},
		{'t': '2023/4/17 09:10', 'n': '27'},
		{'t': '2023/4/17 09:10', 'n': '27'},
		{'t': '2023/4/17 09:11', 'n': '26'},
		{'t': '2023/4/17 09:11', 'n': '20'},
		{'t': '2023/4/17 09:11', 'n': '20'},
		{'t': '2023/4/17 09:12', 'n': '21'},
		{'t': '2023/4/17 09:12', 'n': '19'},
		{'t': '2023/4/17 09:13', 'n': '25'},
		{'t': '2023/4/17 09:13', 'n': '16'},
		{'t': '2023/4/17 09:14', 'n': '15'},
		{'t': '2023/4/17 09:14', 'n': '15'},
		{'t': '2023/4/17 09:15', 'n': '18'},
		{'t': '2023/4/17 09:15', 'n': '17'},
		{'t': '2023/4/17 09:16', 'n': '10'},
		{'t': '2023/4/17 09:16', 'n': '12'},
		{'t': '2023/4/17 09:17', 'n': '12'},
		{'t': '2023/4/17 09:17', 'n': '13'},
		{'t': '2023/4/17 09:18', 'n': '14'},
		{'t': '2023/4/17 09:18', 'n': '12'},
		{'t': '2023/4/17 09:19', 'n': '19'},
		{'t': '2023/4/17 09:19', 'n': '18'},
		{'t': '2023/4/17 09:20', 'n': '14'},
		{'t': '2023/4/17 09:20', 'n': '14'},
		{'t': '2023/4/17 09:21', 'n': '15'},
		{'t': '2023/4/17 09:21', 'n': '16'},
		{'t': '2023/4/17 09:22', 'n': '11'},
		{'t': '2023/4/17 09:22', 'n': '12'},
		{'t': '2023/4/17 09:23', 'n': '10'},
		{'t': '2023/4/17 09:23', 'n': '13'},
		{'t': '2023/4/17 09:24', 'n': '11'},
		{'t': '2023/4/17 09:24', 'n': '16'},
		{'t': '2023/4/17 09:25', 'n': '13'},
		{'t': '2023/4/17 09:25', 'n': '9'},
		{'t': '2023/4/17 09:26', 'n': '7'},
		{'t': '2023/4/17 09:26', 'n': '6'},
		{'t': '2023/4/17 09:26', 'n': '6'},
		{'t': '2023/4/17 09:27', 'n': '9'},
		{'t': '2023/4/17 09:27', 'n': '12'},
		{'t': '2023/4/17 09:28', 'n': '7'},
		{'t': '2023/4/17 09:28', 'n': '8'},
		{'t': '2023/4/17 09:29', 'n': '8'},
		{'t': '2023/4/17 09:29', 'n': '12'},
		{'t': '2023/4/17 09:30', 'n': '11'},
		{'t': '2023/4/17 09:30', 'n': '8'},
		{'t': '2023/4/17 09:31', 'n': '12'},
		{'t': '2023/4/17 09:31', 'n': '11'},
		{'t': '2023/4/17 09:32', 'n': '10'},
		{'t': '2023/4/17 09:32', 'n': '12'},
		{'t': '2023/4/17 09:33', 'n': '9'},
		{'t': '2023/4/17 09:33', 'n': '10'},
		{'t': '2023/4/17 09:34', 'n': '9'},
		{'t': '2023/4/17 09:34', 'n': '11'},
		{'t': '2023/4/17 09:35', 'n': '12'},
		{'t': '2023/4/17 09:35', 'n': '7'},
		{'t': '2023/4/17 09:36', 'n': '8'},
		{'t': '2023/4/17 09:36', 'n': '7'},
		{'t': '2023/4/17 09:37', 'n': '9'},
		{'t': '2023/4/17 09:37', 'n': '9'},
		{'t': '2023/4/17 09:38', 'n': '9'},
		{'t': '2023/4/17 09:38', 'n': '8'},
		{'t': '2023/4/17 09:39', 'n': '8'},
		{'t': '2023/4/17 09:39', 'n': '8'},
		{'t': '2023/4/17 09:40', 'n': '8'},
		{'t': '2023/4/17 09:40', 'n': '8'},
		{'t': '2023/4/17 09:40', 'n': '10'},
		{'t': '2023/4/17 09:41', 'n': '9'},
		{'t': '2023/4/17 09:41', 'n': '11'},
		{'t': '2023/4/17 09:42', 'n': '10'},
		{'t': '2023/4/17 09:42', 'n': '7'},
		{'t': '2023/4/17 09:43', 'n': '10'},
		{'t': '2023/4/17 09:43', 'n': '10'},
		{'t': '2023/4/17 09:44', 'n': '10'},
		{'t': '2023/4/17 09:44', 'n': '9'},
		{'t': '2023/4/17 09:45', 'n': '8'},
		{'t': '2023/4/17 09:45', 'n': '9'},
		{'t': '2023/4/17 09:46', 'n': '10'},
		{'t': '2023/4/17 09:46', 'n': '8'},
		{'t': '2023/4/17 09:47', 'n': '12'},
		{'t': '2023/4/17 09:47', 'n': '8'},
		{'t': '2023/4/17 09:48', 'n': '8'},
		{'t': '2023/4/17 09:48', 'n': '8'},
		{'t': '2023/4/17 09:49', 'n': '8'},
		{'t': '2023/4/17 09:49', 'n': '10'},
		{'t': '2023/4/17 09:50', 'n': '10'},
		{'t': '2023/4/17 09:50', 'n': '10'},
		{'t': '2023/4/17 09:51', 'n': '9'},
		{'t': '2023/4/17 09:51', 'n': '7'},
		{'t': '2023/4/17 09:52', 'n': '9'},
		{'t': '2023/4/17 09:52', 'n': '8'},
		{'t': '2023/4/17 09:53', 'n': '7'},
		{'t': '2023/4/17 09:53', 'n': '8'},
		{'t': '2023/4/17 09:54', 'n': '7'},
		{'t': '2023/4/17 09:54', 'n': '6'},
		{'t': '2023/4/17 09:55', 'n': '6'},
		{'t': '2023/4/17 09:55', 'n': '6'},
		{'t': '2023/4/17 09:55', 'n': '7'},
		{'t': '2023/4/17 09:56', 'n': '8'},
		{'t': '2023/4/17 09:56', 'n': '11'},
		{'t': '2023/4/17 09:57', 'n': '7'},
		{'t': '2023/4/17 09:57', 'n': '10'},
		{'t': '2023/4/17 09:58', 'n': '7'},
		{'t': '2023/4/17 09:58', 'n': '9'},
		{'t': '2023/4/17 09:59', 'n': '9'},
		{'t': '2023/4/17 09:59', 'n': '7'}
		];
var fakedata = {};
let fakelistt = [];
let fakelistn = [];
fakeresult.forEach(function (json, i) {
	fakelistt[i] = json.t;
	fakelistn[i] = json.n;
});
fakedata.t = fakelistt;
fakedata.n = fakelistn;
results['fake'] = fakedata;
Object.keys(results).forEach(function (type, index) {
	var result = results[type];
	var labels = result['t'];
	delete result['t'];
	var cloneLab = $('#lab').clone(true);
	var item = '';
	cloneLab.attr('id', 'lab' + index);
	cloneLab.html(type);
	cloneLab.appendTo('#mainDiv');
	var cloneChart = $("#chart").clone(true);
	cloneChart.attr('id', 'chart' + index);
	jQuery("<div></div>", {
	    id: 'div' + index
	})
	.css('height', '400px')
	.css('width', '1500px')
	.appendTo('#mainDiv');
	cloneChart.appendTo('#div' + index);
	let datasets = [];
	Object.keys(result).forEach(function (item, idx) {
		let data = result[item];
		datasets[idx] = {
	    	label: item,
	        data: data,
	        fill: false,
	        borderColor: rgbs[idx]
	    };
	});
	var ctx = document.getElementById('chart' + index);
	var myChart = new Chart(ctx, {
	    type: 'line',
	    options: {  
	        responsive: true,
	        maintainAspectRatio: false
	    },
	    data: {
	        labels: labels,
	        datasets: datasets
	    },
	});
});
var waittime = 29 * 1000;
$(document).ready(function() {
	var date = new Date();
	console.log('ready time' + date);
	if (date.getHours() < 13) {
		setTimeout(() => location.reload(), waittime * 1000);
	} else if (date.getHours() == 13 &&¡@date.getMinutes() < 25) {
		setTimeout(() => location.reload(), waittime * 1000);
	}
});
</script>
</body>
</html>